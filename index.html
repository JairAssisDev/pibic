<!DOCTYPE html>
<html>

<head>
    <title>Consumir API Flask</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Consumir API Flask</h1>
    <label for="id">id:</label>
    <input type="number" id="id" placeholder="id"><br><br>

    <label for="nome">nome:</label>
    <input type="text" id="nome" placeholder="nome"><br><br>

    <label for="cpf">cpf:</label>
    <input type="text" id="cpf" placeholder="cpf"><br><br>

    <label for="sex">Sexo:</label>
    <input type="number" id="sex" placeholder="Sexo"><br><br>

    <label for="redo">Redo:</label>
    <input type="number" id="redo" placeholder="Redo"><br><br>

    <label for="cpb">CPB:</label>
    <input type="number" id="cpb" placeholder="CPB"><br><br>

    <label for="age">Idade:</label>
    <input type="number" id="age" placeholder="Idade"><br><br>

    <label for="bsa">BSA:</label>
    <input type="number" id="bsa" placeholder="BSA"><br><br>

    <label for="hb">HB:</label>
    <input type="number" id="hb" placeholder="HB"><br><br>

    <button onclick="cadastrar_paciente()">Cadastrar paciente</button>

    <div id="resultado"></div>
    <br>
    <br>

    <h1>prever por paciente</h1>

    <label for="nome">Nome do paciente:</label>
    <input type="text" id="nome_paciente" placeholder="nome_paciente"><br><br>
    <button onclick="prever()">prever info paciente</button>
    <!-- Div para exibir a imagem base64 -->

    <div id="true_probability"></div>
    <div id="prediction"></div>
    <div id="lime_image">
        <img id="prediction_image" src="" alt="Prediction Image">
    </div>


    <script>
        async function cadastrar_paciente() {
            // Obter os valores dos campos de entrada
            var id = parseInt(document.getElementById("id").value);
            var nome = document.getElementById("nome").value;
            var cpf = document.getElementById("cpf").value;
            var sex = parseInt(document.getElementById("sex").value);
            var redo = parseInt(document.getElementById("redo").value);
            var cpb = parseInt(document.getElementById("cpb").value);
            var age = parseFloat(document.getElementById("age").value);
            var bsa = parseFloat(document.getElementById("bsa").value);
            var hb = parseFloat(document.getElementById("hb").value);

            // Construir o objeto de dados
            var data = {
                "id": id,
                "nome": nome,
                "cpf": cpf,
                "sex": sex,
                "redo": redo,
                "cpb": cpb,
                "age": age,
                "bsa": bsa,
                "hb": hb
            };

            try {

                const response = await axios.post("http://127.0.0.1:5000/patient", data);

                if (response.status == 201) {
                    document.getElementById("resultado").innerText = "Success: " + response.data.mensagem;
                } else {
                    document.getElementById("resultado").innerText = "Erro: " + response.statusText;
                }
            } catch (error) {
                console.error("Erro ao fazer a requisição:", error);
            }
        }

        // Corrigindo a função prever()
        async function prever() {
            var nome = document.getElementById("nome_paciente").value;
            try {
                const response = await axios.get("http://127.0.0.1:5000/patient/predict/" + nome);

                if (response.status == 200) {
                    console.log(response.data.prediction);

                    // Verifica se o elemento "prediction" existe
                    var predictionElement = document.getElementById("true_probability");
                    var predictionElement = document.getElementById("prediction");
                    if (predictionElement) {
                        predictionElement.innerText = "Success: " + response.data.prediction.true_probability;
                        predictionElement.innerText = "Classe: " + response.data.prediction.prediction;
                    } else {
                        console.error("Elemento 'prediction' não encontrado.");
                    }

                    const image = response.data.prediction.lime_image;
                    console.log(image);

                    // Verifica se o elemento "prediction_image" existe
                    var predictionImageElement = document.getElementById("prediction_image");
                    if (predictionImageElement) {
                        predictionImageElement.src = 'data:image/jpeg;base64,' + image;
                    } else {
                        console.error("Elemento 'prediction_image' não encontrado.");
                    }
                } else {
                    document.getElementById("resultado_predict").innerText = "Erro: " + response;
                }
            } catch (error) {
                console.error("Erro ao fazer a requisição:", error);
            }
        }

    </script>
</body>

</html>