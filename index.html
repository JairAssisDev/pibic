<!DOCTYPE html>
<html>

<head>
    <title>Consumir API Flask</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Consumir API Flask</h1>

    <label for="nome">Nome:</label>
    <input type="text" id="nome" placeholder="Nome"><br><br>

    <label for="cpf">CPF:</label>
    <input type="text" id="cpf" placeholder="CPF"><br><br>

    <label for="sex">Sexo:</label>
    <input type="number" id="sex" placeholder="Sexo"><br><br>

    <label for="redo">Redo:</label>
    <input type="number" id="redo" placeholder="Redo"><br><br>

    <label for="cpb">CPB:</label>
    <input type="number" id="cpb" placeholder="CPB"><br><br>

    <label for="age">Idade:</label>
    <input type="number" id="age" placeholder="Idade"><br><br>

    <label for="bsa">BSA:</label>
    <input type="number" id="bsa" placeholder="BSA"><br><br>

    <label for="hb">HB:</label>
    <input type="number" id="hb" placeholder="HB"><br><br>

    <button onclick="cadastrarPaciente()">Cadastrar paciente</button>

    <div id="resultado"></div>
    <br>
    <br>

    <h1>Prever informações do paciente</h1>

    <label for="nome_paciente">Nome do paciente:</label>
    <input type="text" id="nome_paciente" placeholder="Nome do paciente"><br><br>
    <button onclick="prever()">Prever informações do paciente</button>
    <!-- Div para exibir a imagem base64 -->

    <div id="true_probability"></div>
    <div id="prediction"></div>
    <div id="lime_image">
        <img id="prediction_image" src="" alt="Prediction Image">
    </div>


    <script>
        async function cadastrarPaciente() {
            // Obter os valores dos campos de entrada
            var nome = document.getElementById("nome").value;
            var cpf = document.getElementById("cpf").value;
            var sex = parseInt(document.getElementById("sex").value);
            var redo = parseInt(document.getElementById("redo").value);
            var cpb = parseInt(document.getElementById("cpb").value);
            var age = parseFloat(document.getElementById("age").value);
            var bsa = parseFloat(document.getElementById("bsa").value);
            var hb = parseFloat(document.getElementById("hb").value);

            // Construir o objeto de dados
            var data = {
                "nome": nome,
                "cpf": cpf,
                "sex": sex,
                "redo": redo,
                "cpb": cpb,
                "age": age,
                "bsa": bsa,
                "hb": hb
            };

            try {
                const response = await axios.post("http://127.0.0.1:5000/paciente", data);

                if (response.status == 201) {
                    document.getElementById("resultado").innerText = "Paciente criado com sucesso";
                    // Após criar o paciente com sucesso, faz a previsão
                    await prever();
                } else {
                    document.getElementById("resultado").innerText = "Erro ao criar paciente: " + response.statusText;
                }
            } catch (error) {
                console.error("Erro ao fazer a requisição:", error);
            }
        }

        async function prever() {
            var nome = document.getElementById("nome_paciente").value;
            try {
                const response = await axios.get("http://127.0.0.1:5000/paciente/nome/" + nome);

                if (response.status == 200) {
                    console.log(response.data.prediction);

                    // Exibir as informações da previsão
                    var predictionElement = document.getElementById("prediction");
                    var trueProbabilityElement = document.getElementById("true_probability");
                    var predictionImageElement = document.getElementById("prediction_image");

                    if (predictionElement && trueProbabilityElement && predictionImageElement) {
                        predictionElement.innerText = "Classe: " + response.data.prediction;
                        trueProbabilityElement.innerText = "Probabilidade: " + response.data.true_probability;
                        predictionImageElement.src = 'data:image/jpeg;base64,' + response.data.imagem;
                    } else {
                        console.error("Elemento 'prediction' ou 'true_probability' ou 'prediction_image' não encontrado.");
                    }
                } else {
                    console.error("Erro ao obter previsão:", response.statusText);
                }
            } catch (error) {
                console.error("Erro ao fazer a requisição:", error);
            }
        }
    </script>
</body>

</html>